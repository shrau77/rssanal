name: NTC Scraper (Tor Network)

on:
  schedule:
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ==========================================
      # üßÖ –£–°–¢–ê–ù–û–í–ö–ê –ò –ó–ê–ü–£–°–ö TOR
      # ==========================================
      - name: Install and Start Tor
        run: |
          sudo apt-get update
          sudo apt-get install -y tor tesseract-ocr tesseract-ocr-rus libtesseract-dev
          sudo service tor start
          # –î–∞–µ–º –¢–æ—Ä—É 30 —Å–µ–∫ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏
          echo "Waiting for Tor to bootstrap..."
          sleep 30
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Ä—Ç 9050 –æ—Ç–∫—Ä—ã–ª—Å—è
          netstat -lnp | grep 9050 || echo "Tor port check failed (might still work)"
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º IP —á–µ—Ä–µ–∑ –¢–æ—Ä (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
          curl --socks5 127.0.0.1:9050 https://check.torproject.org/api/ip

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Python Libraries
        run: pip install -r requirements.txt

      - name: Run Scraper
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          MY_GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
        run: python scraper.py
