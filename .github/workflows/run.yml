name: NTC Scraper (WARP Mode)

on:
  schedule:
    - cron: '0 */2 * * *' # –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
  workflow_dispatch:      # –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

jobs:
  scrape:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # ==================================================
      # üõ°Ô∏è –ö–û–õ–•–û–ó–ò–ú WARP (–û–ë–•–û–î –ë–ê–ù–ê –ü–û IP)
      # ==================================================
      - name: Install Cloudflare WARP
        uses: fscarmen/warp-on-actions@v1.2
        with:
          stack: ipv4 # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ IPv4, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—ã

      - name: Check Network (Debug)
        run: |
          echo "Public IP after WARP:"
          curl -s https://ifconfig.me
          echo ""
          echo "Trying to reach ntc.party..."
          curl -I https://ntc.party || echo "Curl check failed (it's ok if python handles it)"

      # ==================================================
      # ‚öôÔ∏è –û–ë–´–ß–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø
      # ==================================================
      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y tesseract-ocr tesseract-ocr-rus libtesseract-dev

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Python Libraries
        run: pip install -r requirements.txt

      - name: Run Scraper
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          MY_GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
          # –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø–∞–¥–∞–µ—Ç –Ω–∞ SSL –≤–Ω—É—Ç—Ä–∏ WARP, –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
          # CURL_CA_BUNDLE: "" 
        run: python scraper.py
